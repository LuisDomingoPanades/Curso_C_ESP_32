#include <MPU9250.h>


MPU9250 mpu;
const int PWMpin=32;
const int freq=5000;
const int ledChannel=0;
const int resolution=12;
int led;
float prevmillis=0;
float prevmillis_1=0;
float AccX;
float AccY;
float AccZ;
void setup() {
    Serial.begin(115200);
    Wire.begin();
    delay(2000);
    ledcSetup(ledChannel,freq,resolution);
    ledcAttachPin(PWMpin, ledChannel);
    

    if (!mpu.setup(0x68)) {  // change to your own address
        while (1) {
            Serial.println("MPU connection failed. Please check your connection with `connection_check` example.");
            delay(5000);
        }
    }
}


void loop() {
    if (mpu.update()){
        if (100<(millis()-prevmillis)) {
            muestrea();
        }
      }
    if (1000<(millis()-prevmillis_1)) {
        prevmillis_1=millis();
        print_acc();
    }
    if ((led==1) and (millis()>prevmillis_1+200)){
    led=0;
    ledcWrite(ledChannel,0);
    }
}
void muestrea() {
        prevmillis=millis();
        AccX=mpu.getAccX();
        AccY=mpu.getAccY();
        AccZ=mpu.getAccZ();
}
void print_acc() {
    Serial.print("Acceleration X,Y,Z ");
    Serial.print(AccX, 2);
    Serial.print(", ");
    Serial.print(AccY, 2);
    Serial.print(", ");
    Serial.println(AccZ, 2);
    ledcWrite(ledChannel,2045);
    led=1;
    
}
